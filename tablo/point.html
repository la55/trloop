<!DOCTYPE html>
<html>
<head>
    <title>Point race</title>
    <script src="vue.min.js"></script>
</head>
<style>
 body {background-color: #000; color: #fff; padding: 0; margin: 0 }
 table td {padding: 2; margin: 0 }
 input, button {font-size: 16px;  }
 .control { float: right; padding-right: 200px }
 #root { padding: 0; margin: 0 }
</style>
<body>
    <div id='root'>
	    <table>
		    <tr v-for="(p, i) in sorted" v-if="isDisplay(i)">
			<td v-text="i + 1"></td>
			<td v-text="'â„–' + p.bib"></td>
			<td v-text="p.family"></td>
			<td v-text="p.region"></td>
			<td v-text="p.points"></td>
		</tr>
	    </table>
	<div class="control">
	<br>
	<br>
	Offset: <input type="text" v-model="offset" size="1" name="offset">
	<button @click="addBib()">Add Player</button>
	<br>
	<br>
	<input type="text" v-model="f1" size="1" name="f1">
	<input type="text" v-model="f2" size="1" name="f2">
	<input type="text" v-model="f3" size="1" name="f3">
	<input type="text" v-model="f4" size="1" name="f4">
	<button @click="intFinish()">Finish</button>
	<br>
	<button @click="plusTw()">+20</button>
	<input type="text" v-model="bib" size="1" name="bib">
	<button @click="minusTw()">-20</button>
	    <table>
		    <tr v-for="p in sorted">
			<td><input size="1" @change="saveBibs" v-model="p.bib"></input></td>
			<td><input size="3" @change="saveBibs"  v-model="p.family"></input></td>
			<td><input size="2" @change="saveBibs"  v-model="p.region"></input></td>
			<td><input size="1" @change="saveBibs"  v-model="p.points"></input></td>
			<td><button @click="deleteBib(p.bib)">x</button></td>
		</tr>
	    </table>
	</div>
    </div>
<script>
  var app = new Vue({
    
    el : '#root',

    data: {
	f1: '',
	f2: '',
	f3: '',
	f4: '',
	offset: 0,
	bib: '',
        bibs: [],
    },

    created: function () {
	    setInterval(this.changeOffset, 5000)
	    let bibs = localStorage.getItem('bibs', [])
	    if (bibs == null) {
		this.bibs = []
	    } else {
		this.bibs = JSON.parse(bibs)
	    }
    },

    computed: {
      sorted : function () {
        return this.bibs.sort((a, b) => b.points - a.points)
      }
    },

    methods: {
      changeOffset: function () {
	 let ofs = parseInt(this.offset)
	 ofs += 3
	 if (ofs >= this.bibs.length) {
		ofs = 0
	 }
	 this.offset = ofs
      },
      isDisplay: function (i) {
	  let ofs = parseInt(this.offset)
	  let max = ofs + 3
	  let tf = i < max & i >= ofs
	  return tf
      },
      getByBib: function (bib) {
	 return this.bibs.filter(p => p.bib == bib)[0]
      },
      plusTw: function () {
	 p1 = this.getByBib(parseInt(this.bib))
	 p1.points += 20 
	 this.bib = ''
      },
      minusTw: function () {
	 p1 = this.getByBib(parseInt(this.bib))
	 p1.points -= 20 
	 this.bib = ''
      },
      intFinish: function () {
	 p1 = this.getByBib(parseInt(this.f1))
	 p1.points += 5
	 this.f1 = 0
	 p2 = this.getByBib(parseInt(this.f2))
	 p2.points += 3
	 this.f2 = 0
	 p3 = this.getByBib(parseInt(this.f3))
	 p3.points += 2
	 this.f3 = 0
	 p4 = this.getByBib(parseInt(this.f4))
	 p4.points += 1
	 this.f4 = 0
      },
      deleteBib: function (bib) {
	 this.bibs = this.bibs.filter(p => p.bib != bib)
	 this.saveBibs()
      },
      saveBibs: function () {
	localStorage.setItem('bibs', JSON.stringify(this.bibs))
      },
      addBib: function () {
	this.bibs.push({ bib: 0, family: '', region: '', points: 0 })	
	this.saveBibs()
      }
    }

  });
</script>
</body>
</html>

