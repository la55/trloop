<!DOCTYPE html>
<html>
<head>
    <title>Point race</title>
    <script src="vue.min.js"></script>
</head>
<style>
 body {background-color: #000; color: #fff; padding: 0; margin: 0 }
 table td {padding: 2; margin: 0 }
 input, button {font-size: 24px;  }
 #control {  }
 #root { padding: 0; margin: 0 }
 #tablo { display: flex; height: 10rem; }
 .tablo-col { display: flex; padding: 1rem; }
</style>
<body>
	<div id='root'>
		<div id="tablo">
	    <div class="tablo-col">
				<tablotable :bibs="tabloone"></tablotable>
			</div>
	    <div class="tablo-col">
				<tablotable :bibs="tablotwo"></tablotable>
			</div>
		</div><!-- #tablo -->
		<div class="control">
			<input type="text" v-model="f1" size="1" name="f1">
			<input type="text" v-model="f2" size="1" name="f2">
			<input type="text" v-model="f3" size="1" name="f3">
			<input type="text" v-model="f4" size="1" name="f4">
			<button @click="intFinish()">Finish</button>
			<br>
			<button @click="plusTw()">+20</button>
			<input type="text" v-model="bib" size="1" name="bib">
			<button @click="minusTw()">-20</button>
			<button @click="sortBibs()">Sort</button>
			<button @click="addBib()">Add Player</button>
			<table>
				<tr v-for="pl in bibs">
					<td><input size="1" @change="saveBibs" v-model="pl.bib"></input></td>
					<td><input size="3" @change="saveBibs"  v-model="pl.family"></input></td>
					<td><input size="2" @change="saveBibs"  v-model="pl.region"></input></td>
					<td><input size="1" @change="saveBibs"  v-model.number="pl.points"></input></td>
					<td><button @click="deleteBib(pl.bib)">x</button></td>
				</tr>
			</table>
		</div><!-- Control -->
	</div> <!-- Root -->
<script>
	Vue.component('tablotable', {
		template: `
				<table>
					<tr v-for="(p, i) in bibs"">
						<td v-text="'â„–' + p.bib"></td>
						<td>-</td>
						<!--<td v-text="p.family"></td>
						<td v-text="p.region"></td>-->
						<td v-text="p.points"></td>
					</tr>
				</table>
		`,
		props: {
			bibs: {
				required: true
			}
		}
	})
  var app = new Vue({
    
    el : '#root',

    data: {
	f1: 0,
	f2: 0,
	f3: 0,
	f4: 0,
	offset: 0,
	bib: 0,
        bibs: [],
    },

    created: function () {
	    setInterval(this.changeOffset, 3000)
	    let bibs = localStorage.getItem('bibs', [])
	    if (bibs == null) {
			this.bibs = []
				} else {
			this.bibs = JSON.parse(bibs)
				}
    },

    computed: {
      sorted : function () {
        return this.bibs.sort((a, b) => b.points - a.points)
      },
      tabloone : function () {
				let ofs = parseInt(this.offset)
				let max = ofs + 4
        return this.bibs.slice(ofs,max)
      },
      tablotwo : function () {
				let ofs = parseInt(this.offset) + 4
				let max = ofs + 4
        return this.bibs.slice(ofs,max)
      }
    },

    methods: {
      sortBibs : function () {
        return this.bibs.sort((a, b) => b.points - a.points)
      },
			changeOffset: function () {
			 let ofs = parseInt(this.offset)
			 ofs += 8
			 if (ofs >= this.bibs.length) {
				ofs = 0
			 }
			 this.offset = ofs
			 console.log(this.offset)
			},
      getByBib: function (bib) {
	 return this.bibs.filter(p => p.bib == bib)[0]
      },
      plusTw: function () {
	 p1 = this.getByBib(parseInt(this.bib))
	 p1.points += 20 
	 this.bib = ''
	 this.saveBibs()
	 this.sortBibs()
      },
      minusTw: function () {
	 p1 = this.getByBib(parseInt(this.bib))
	 p1.points -= 20 
	 this.bib = ''
	 this.saveBibs()
	 this.sortBibs()
      },
      intFinish: function () {
	 p1 = this.getByBib(parseInt(this.f1))
	 p1.points = parseInt(p1.points) + 5
	 this.f1 = '' 
	 p2 = this.getByBib(parseInt(this.f2))
	 p2.points = parseInt(p2.points) + 3
	 this.f2 = '' 
	 p3 = this.getByBib(parseInt(this.f3))
	 p3.points = parseInt(p3.points) + 2
	 this.f3 = '' 
	 p4 = this.getByBib(parseInt(this.f4))
	 p4.points = parseInt(p4.points) + 1
	 this.f4 = ''
	 this.saveBibs()
	 this.sortBibs()
      },
      deleteBib: function (bib) {
	 this.bibs = this.bibs.filter(p => p.bib != bib)
	 this.sortBibs()
	 this.saveBibs()
      },
      saveBibs: function () {
	localStorage.setItem('bibs', JSON.stringify(this.bibs))
      },
      addBib: function () {
	this.bibs.push({ bib: '', family: '', region: '', points: 0 })	
	this.sortBibs()
	this.saveBibs()
      }
    }

  });
</script>
</body>
</html>

